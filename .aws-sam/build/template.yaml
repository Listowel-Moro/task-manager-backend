AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: Task Management System Backend - Main Template
Resources:
  CognitoStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: CognitoStack\template.yaml
      Parameters:
        TeamMemberSubscriptionStepFunctionArn:
          Fn::GetAtt:
          - StepFunctionsStack
          - Outputs.TeamMemberSubscriptionStepFunctionArn
        TaskAssignmentNotificationTopicArn:
          Fn::GetAtt:
          - SnsSqsStack
          - Outputs.TaskAssignmentNotificationTopicArn
      Tags:
      - Key: Component
        Value: Cognito
    Metadata:
      SamResourceId: CognitoStack
  SnsSqsStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: SnsSqsStack\template.yaml
      Tags:
      - Key: Component
        Value: SNS-SQS
    Metadata:
      SamResourceId: SnsSqsStack
  StepFunctionsStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: StepFunctionsStack\template.yaml
      Parameters:
        TaskAssignmentNotificationTopicArn:
          Fn::GetAtt:
          - SnsSqsStack
          - Outputs.TaskAssignmentNotificationTopicArn
        TaskDeadlineNotificationTopicArn:
          Fn::GetAtt:
          - SnsSqsStack
          - Outputs.TaskDeadlineNotificationTopicArn
        ClosedTasksNotificationTopicArn:
          Fn::GetAtt:
          - SnsSqsStack
          - Outputs.ClosedTasksNotificationTopicArn
      Tags:
      - Key: Component
        Value: StepFunctions
    Metadata:
      SamResourceId: StepFunctionsStack
Outputs:
  ApiUrlCognito:
    Description: API Gateway endpoint URL
    Value:
      Fn::GetAtt:
      - CognitoStack
      - Outputs.ApiUrl
